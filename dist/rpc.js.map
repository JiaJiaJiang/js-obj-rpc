{"version":3,"file":"rpc.js","sources":["../node_modules/eventemitter3/index.js","../index.js"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","/*\r\nCopyright luojia@luojia.me\r\nMIT LICENSE\r\n*/\r\n\r\n/* \r\nmessage structure\r\nByte 0\r\n\t[0] \t\t0:request\r\n\t\t\t\t1:response\r\n\t[1] request:\t0: no id\r\n\t\t\t\t\t1:has id\r\n\t\tresponse:\t0:normal response\r\n\t\t\t\t\t1:error message\r\n\t[2] reserved\r\n\t[3-7] message type\r\n\t\t0-7: \tsee: ControlMsg\r\n\t\t8:\t\tdata true\r\n\t\t9:\t\tdata false\r\n\t\t10:\t\tdata binary\r\n\t\t11:\t\tdata string\r\n\t\t12:\t\tdata json string\r\n\t\t13:\t\tdata double js number\r\n\t\t14:\t\tdata undefined\r\n\t\t15:\t\tdata null\r\n\t\t16:\t\tdata bigint\r\n\t\t16-31:\treserved\r\n[\r\n\tByte 1-4\r\n\t\tmessage id (if has id or is a response)\r\n\tByte 5-8\r\n\t\trandom number\r\n]\r\nByte -\r\n\tdata\r\n*/\r\nvar events=require('eventemitter3');\r\n\r\n//Polyfill\r\nNumber.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=0x1fffffffffffff);\r\nif(!Number.isSafeInteger)\r\nNumber.isSafeInteger=function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER};\r\nif(!Number.isInteger)\r\nNumber.isInteger=function(b){return\"number\"==typeof b&&isFinite(b)&&Math.floor(b)===b};\r\n\r\n\r\nconst SUPPORT_ARRAYBUFFER=!!global.ArrayBuffer;\r\nconst TypedArray=SUPPORT_ARRAYBUFFER&&global.Float32Array.prototype.constructor.__proto__;\r\nif(SUPPORT_ARRAYBUFFER && !ArrayBuffer.isView){//ArrayBuffer.isView\r\n\tArrayBuffer.isView=a=>!!((TypedArray&&(a instanceof TypedArray))||(global.DataView&&(a instanceof DataView)));\r\n}\r\n\r\nconst encoder = new TextEncoder();\r\nconst decoder=new TextDecoder()\r\nconst tmpFloat64Array1=new Float64Array(1),\r\n\ttmpUint8Array1=new Uint8Array(1),\r\n\ttmpUint8Array9=new Uint8Array(9);\r\nfunction strToUint8(str){\r\n\treturn encoder.encode(str);\r\n}\r\nfunction uint8ToStr(uint8){\r\n\treturn decoder.decode(uint8);\r\n}\r\nfunction concatArrayBuffers(buffers){\r\n\tlet offsets=new Array(buffers.length),totalLength=0;\r\n\tfor(let ai=0;ai<buffers.length;ai++){\r\n\t\toffsets[ai]=totalLength;\r\n\t\ttotalLength+=buffers[ai].byteLength;\r\n\t\tif(buffers[ai] instanceof ArrayBuffer){\r\n\t\t\tbuffers[ai]=new Uint8Array(buffers[ai]);\r\n\t\t}\r\n\t}\r\n\tconst result=new Uint8Array(totalLength);\r\n\tfor(let i=0;i<buffers.length;i++){\r\n\t\tresult.set(buffers[i],offsets[i]);\r\n\t}\r\n\treturn result;\r\n}\r\n/**\r\n * @description\tMessage object\r\n * @class Message\r\n */\r\nclass Message{\r\n\tid;\r\n\trandom;\r\n\thead;\r\n\ttype;\r\n\t_data;\r\n\thasID;\r\n\tpayload;\r\n\tisRequest;\r\n\t/**\r\n\t * Creates an instance of Message.\r\n\t * @param {ArrayBuffer} data\r\n\t */\r\n\tconstructor(data){\r\n\t\tif(ArrayBuffer.isView(data))data=data.buffer;\r\n\t\telse if(!(data instanceof ArrayBuffer)){\r\n\t\t\tthrow(new TypeError('Wrong data'));\r\n\t\t}\r\n\t\tif(data.byteLength===0){\r\n\t\t\tthrow(new Error('Bad message'));\r\n\t\t}\r\n\t\tdata=new Uint8Array(data);\r\n\t\tthis.head=data[0];\r\n\t\tthis.isRequest=(this.head&0b10000000)===0;\r\n\t\tthis.hasID=this.isRequest?(this.head&0b01000000)===0b01000000:true;\r\n\t\t// this.finished=(head&0b00100000)===0b00100000;//finished flag\r\n\t\tif(this.hasID){//calc id\r\n\t\t\tif(data.byteLength<5){\r\n\t\t\t\tthrow(new Error('Bad message'));\r\n\t\t\t}\r\n\t\t\tconst view=new DataView(data.buffer);\r\n\t\t\tthis.id=view.getUint32(1);\r\n\t\t\tthis.random=view.getUint32(5);\r\n\t\t}\r\n\t\tthis.type=this.head&0b00011111;//type of the message\r\n\t\tthis.payload=data.buffer.slice(this.hasID?9:1);\r\n\t\tthis._data;//data cache\r\n\t}\r\n\t/**\r\n\t * @description\tis control message\r\n\t * @readonly\r\n\t */\r\n\tget isCtrl(){\r\n\t\treturn this.type<8;\r\n\t}\r\n\t/**\r\n\t * @description\tis error message\r\n\t * @readonly\r\n\t */\r\n\tget isError(){\r\n\t\tif((this.head&0x40)===0x40){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t/**\r\n\t * @description parse data\r\n\t * @returns {any}\tcarried data\r\n\t */\r\n\tdata(){\r\n\t\tif(this._data!==undefined)return this._data;\r\n\t\tthis._data=(()=>{\r\n\t\t\tif(this.type<8)return ControlMsg.parseData(this.type,this.payload);\r\n\t\t\tswitch(this.type){\r\n\t\t\t\tcase 8:return true;\r\n\t\t\t\tcase 9:return false;\r\n\t\t\t\tcase 10:return this.payload;//binary\r\n\t\t\t\tcase 11:return uint8ToStr(this.payload);//string\r\n\t\t\t\tcase 12:return JSON.parse(uint8ToStr(this.payload));//json\r\n\t\t\t\tcase 13://js number\r\n\t\t\t\t\tif(this.payload.byteLength!==8)\r\n\t\t\t\t\t\tthrow('Wrong data length for number');\r\n\t\t\t\t\tconst view=new DataView(this.payload);\r\n\t\t\t\t\treturn view.getFloat64(0);\r\n\t\t\t\tcase 14:return undefined;\r\n\t\t\t\tcase 15:return null;\r\n\t\t\t\tcase 16:{\r\n\t\t\t\t\tconst bStr=uint8ToStr(this.payload);\r\n\t\t\t\t\tif(bStr[0]==='-')return -BigInt('0x'+bStr.slice(1));\r\n\t\t\t\t\treturn BigInt('0x'+bStr);\r\n\t\t\t\t}\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow('Unknown data type');\r\n\t\t\t}\r\n\t\t})();\r\n\t\treturn this._data;\r\n\t}\r\n\t/**\r\n\t * @description\tconvert different data to message format buffer\r\n\t * @static\r\n\t * @param {any} data\tdata that defined at top of this file\r\n\t * @returns {[number,ArrayBuffer]}\t[type code, data buffer]\r\n\t */\r\n\tstatic toFrameData(data){\r\n\t\tif(data===undefined)return [14];\r\n\t\tif(data===null)return [15];\r\n\t\tif(data===true)return [8];\r\n\t\tif(data===false)return [9];\r\n\t\tif(data instanceof ErrorMsg){\r\n\t\t\treturn [12,strToUint8(JSON.stringify({code:data.code||4100,msg:data.msg}))];\r\n\t\t}\r\n\t\tif(data instanceof ControlMsg){\r\n\t\t\treturn [data.code,data.buf];\r\n\t\t}\r\n\t\tif(data instanceof ArrayBuffer||ArrayBuffer.isView(data)){\r\n\t\t\treturn [10,data.buffer||data];\r\n\t\t}\r\n\t\tif(data instanceof Error){\r\n\t\t\tthrow('Dont use Error, use RPC.Error instead');\r\n\t\t}\r\n\t\tswitch(typeof data){\r\n\t\t\tcase 'string':return [11,strToUint8(data)];\r\n\t\t\tcase 'object':return [12,strToUint8(JSON.stringify(data))];\r\n\t\t\tcase 'number':\r\n\t\t\t\tconst view=new DataView(tmpFloat64Array1.buffer);\r\n\t\t\t\tview.setFloat64(0,data);\r\n\t\t\t\treturn [13,view.buffer];\r\n\t\t\tcase 'bigint':\r\n\t\t\t\treturn [16,strToUint8(data.toString(16))];\r\n\t\t}\r\n\t\t// console.error('data: ',data);//debug\r\n\t\tthrow(new TypeError('Unsupported data type: '+typeof data));\r\n\t}\r\n\t/**\r\n\t * @description\tpack data into message buffer\r\n\t * @static\r\n\t * @param {boolean} req\tis request\r\n\t * @param {boolean} err\tis error\r\n\t * @param {number} type\ttype code\r\n\t * @param {ArrayBuffer} buf\tdata buffer\r\n\t * @param {number} id\tmessage id\r\n\t * @param {number} randomNum\ta random number for preventing id confict\r\n\t * @returns {ArrayBuffer}  \r\n\t */\r\n\tstatic _pack(req,err,type,buf,id,randomNum){\r\n\t\tlet hasID=typeof id==='number' && id>0;\r\n\t\tlet head=(hasID?tmpUint8Array9:tmpUint8Array1);//alloc the head buffer\r\n\t\thead.fill(0);\r\n\t\tif(req===true){//request\r\n\t\t\tif(hasID)head[0]|=0b01000000;//set id flag\r\n\t\t}else{//response\r\n\t\t\thead[0]=0b10000000;//set as response\r\n\t\t\tif(err){head[0]|=0b01000000;}//set err msg flag\r\n\t\t}\r\n\t\thead[0]|=type;\r\n\t\tlet bufs=[head];\r\n\t\tif(hasID){\r\n\t\t\tif(id>=0xFFFFFFFF)\r\n\t\t\t\tthrow(new Error('id out of range'));\r\n\t\t\tconst view=new DataView(head.buffer);\r\n\t\t\tview.setUint32(1,id);//write id\r\n\t\t\tview.setUint32(5,randomNum);//write randomNum\r\n\t\t}\r\n\t\tif(buf&&buf.byteLength)bufs.push(buf);\r\n\t\treturn concatArrayBuffers(bufs);\r\n\t}\r\n\t/**\r\n\t * @description\tpack data into message buffer\r\n\t * @static\r\n\t * @param {boolean} req\tis request\r\n\t * @param {any} data\tdata to send\r\n\t * @param {number} id\tmessage id\r\n\t * @param {number} randomNum\ta random number for preventing id confict\r\n\t * @returns {ArrayBuffer}\tpacked message\r\n\t */\r\n\tstatic pack(req,data,id,randomNum){//data:buffer, sig:sign the data, finished:the response has finished\r\n\t\tlet [type,buf]=Message.toFrameData(data);//get data type and meg buffer\r\n\t\tlet err=data instanceof ErrorMsg;\r\n\t\treturn Message._pack(req,err,type,buf,id,randomNum);\r\n\t}\r\n\tstatic  msgErrorCodes={\r\n\t\t4100:'',//free message\r\n\t\t4101:'Forbidden',\r\n\t\t4102:'Cannot parse the data',\r\n\t\t4103:'Not supported operation',\r\n\t\t4104:'Duplicate id',\r\n\t\t4105:'Time out',\r\n\t}\r\n\t/**\r\n\t * @description\tis valid id\r\n\t * @static\r\n\t * @param {number} id\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isValidId(id){\r\n\t\treturn typeof id==='number'&&id>0&&id<=0xFFFFFFFF;\r\n\t}\r\n}\r\n\r\n/**\r\n * @description error message\r\n * @class ErrorMsg\r\n */\r\nclass ErrorMsg{\r\n\t/**\r\n\t * Creates an instance of ErrorMsg.\r\n\t * @param {any} code\terror code to return\r\n\t * @param {string} [msg='']\terror message to return\r\n\t */\r\n\tconstructor(code,msg=''){\r\n\t\tthis.code=code;\r\n\t\tif(typeof msg==='string'){\r\n\t\t\tthis.msg=msg;\r\n\t\t}else if(msg instanceof Error){\r\n\t\t\tthis.msg=msg.message;\r\n\t\t}else{\r\n\t\t\tthrow(new Error('Not supported message type'));\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @description control message\r\n * @class ControlMsg\r\n */\r\nclass ControlMsg{\r\n\tstatic cache={};\r\n\tstatic codes={\r\n\t\tabort:1,//abort an operation\r\n\t}\r\n\tcode;\r\n\tbuf;\r\n\t/**\r\n\t * Creates an instance of ControlMsg.\r\n\t * @param {string} name name of the control operation\r\n\t * @param {*} data\tdata of the control message\r\n\t */\r\n\tconstructor(name,data){\r\n\t\tif(name in ControlMsg.codes === false){\r\n\t\t\tthrow(new Error('Unknown operation name'));\r\n\t\t}\r\n\t\tthis.code=ControlMsg.codes[name];\r\n\t\tswitch(this.code){\r\n\t\t\tcase ControlMsg.codes.abort://abort message\r\n\t\t\t\tif(!Message.isValidId(data))\r\n\t\t\t\t\tthrow('Invalid id: '+data);\r\n\t\t\t\tthis.buf=new ArrayBuffer(4);\r\n\t\t\t\t(new DataView(this.buf)).setUint32(0,data);\r\n\t\t\t\t// this.buf.writeUInt32BE(data);//set msg id to be aborted\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description\tconvert control message payload to number\r\n\t * @static\r\n\t * @param {number} code\tcontrol code\r\n\t * @param {ArrayBuffer} buf\tcontrol message payload\r\n\t * @returns {number}  \r\n\t */\r\n\tstatic parseData(code,buf){\r\n\t\tswitch(code){\r\n\t\t\tcase ControlMsg.codes.abort:\r\n\t\t\t\treturn (new DataView(buf)).getUint32(0);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @description request from remote\r\n * @class Request\r\n */\r\nclass Request{\r\n\tresponded=false;\r\n\ttimeout;\r\n\t/**\r\n\t * Creates an instance of Request.\r\n\t * @param {RPC} rpc\r\n\t * @param {number} id\tmessage id\r\n\t * @param {function(...any)} callback\treceive response data\r\n\t * @param {number} random\ta random number for preventing id confict\r\n\t */\r\n\tconstructor(rpc,id,callback,random){\r\n\t\tthis.id=id;\r\n\t\tthis.rpc=rpc;\r\n\t\tthis.cb=callback;\r\n\t\tthis.random=random;\r\n\t}\r\n\t/**\r\n\t * @description\tabort the request, depends on remote data handle\r\n\t */\r\n\tabort(){\r\n\t\tthis.rpc.control('abort',this.id);\r\n\t\tthis.rpc.delete(this);\r\n\t}\r\n\t/**\r\n\t * @description\tfill response data when the remote rpc respond\r\n\t * @param {*} args\r\n\t */\r\n\tcallback(...args){\r\n\t\tif(this.responded)\r\n\t\t\tthrow(new Error('RPC responded'));\r\n\t\tthis.responded=true;\r\n\t\tif(this.cb)\r\n\t\t\tthis.cb(...args);\r\n\t}\r\n\t/**\r\n\t * @description set time out of the request\r\n\t * @param {*} time\r\n\t */\r\n\tsetTimeout(time){//\r\n\t\tif(typeof time!=='number'||!(time>=0))\r\n\t\t\tthrow(new Error('Wrong timeout'));\r\n\t\tif(this.timeout)\r\n\t\t\tclearTimeout(this.timeout);\r\n\t\tthis.timeout=setTimeout(()=>this._timeout(),time);\r\n\t}\r\n\t/**\r\n\t * @description when timeout reaches, an abort control will be sent\r\n\t */\r\n\t_timeout(){\r\n\t\tthis.timeout=0;\r\n\t\tif(this.cb){\r\n\t\t\tthis.cb(new Error('Time out'));\r\n\t\t}\r\n\t\tthis.abort();\r\n\t}\r\n\t_destructor(){\r\n\t\tthis.cb=null;\r\n\t\tthis.rpc=null;\r\n\t\tif(this.timeout){\r\n\t\t\tclearTimeout(this.timeout);\r\n\t\t\tthis.timeout=0;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description\tgenerate a random number\r\n\t * @static\r\n\t * @returns {number}  \r\n\t */\r\n\tstatic generateRandom(){\r\n\t\treturn Math.round(4294967295*Math.random());\r\n\t}\r\n}\r\n\r\n/* \r\nevents\r\n\tabort\r\n*/\r\n/**\r\n * @description incoming request\r\n * @class InRequest\r\n * @extends {events}\r\n */\r\nclass InRequest extends events{\r\n\t_timeout;\r\n\taborted=false;\r\n\tresponded=false;\r\n\tsource;\r\n\t/**\r\n\t * Creates an instance of InRequest.\r\n\t * @param {Message} Message_msg\r\n\t * @param {RPC} rpc\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\tconstructor(Message_msg,rpc,source){\r\n\t\tsuper();\r\n\t\tthis.rpc=rpc;\r\n\t\tthis.msg=Message_msg;\r\n\t\tthis.source=source;\r\n\t}\r\n\t/**\r\n\t * @description\tget message id\r\n\t * @readonly\r\n\t */\r\n\tget id(){return this.msg.id;}\r\n\t/**\r\n\t * @description\tget data of the message, wil be recovered to thier origin type\r\n\t * @returns {any}  \r\n\t */\r\n\tdata(){\r\n\t\treturn this.msg.data();\r\n\t}\r\n\t/**\r\n\t * @description\tset timeout of the incoming request\r\n\t * @param {*} time\r\n\t */\r\n\tsetTimeout(time){\r\n\t\tif(typeof time!=='number'||!(time>=0))\r\n\t\t\tthrow(new Error('Wrong timeout'));\r\n\t\tif(this._timeout)\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\tthis._timeout=setTimeout(()=>this._reachTimeout(),time);\r\n\t}\r\n\t_abort(str_msg){\r\n\t\tthis.aborted=true;\r\n\t\tthis.emit('abort',str_msg);\r\n\t}\r\n\t/**\r\n\t * @description when timeout reaches, rpc will send an error back to remote\r\n\t */\r\n\t_reachTimeout(){\r\n\t\tthis._timeout=0;\r\n\t\tthis._abort('time out');\r\n\t\tthis.rpc._respond(this,RPC.Error(4105));\r\n\t}\r\n\t_destructor(){\r\n\t\tthis.rpc=null;\r\n\t\tthis.msg=null;\r\n\t\tif(this._timeout){\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tthis._timeout=0;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/* \r\nAlways call the callback of the 'request' event, otherwise the requests will reach timeout\r\n*/\r\n/**\r\n * @description RPC handle\r\n * @class RPC\r\n * @extends {events}\r\n */\r\nclass RPC extends events{\r\n\tstatic Error(code,msg){\r\n\t\treturn new ErrorMsg(code,msg||Message.msgErrorCodes[code]||'Unexpected error');\r\n\t}\r\n\t_currentID=1;\r\n\tdefaultRequestTimeout;\r\n\tdefaultResponseTimeout;\r\n\treqList=new Map();//id => Request\r\n\tinReqList=new Map();//id => InRequest\r\n\t_checkerTimer;\r\n\t_sender;\r\n\tconstructor(opt={}){\r\n\t\tsuper();\r\n\t\tthis.defaultRequestTimeout=opt.defaultRequestTimeout||15000;\r\n\t\tthis.defaultResponseTimeout=opt.defaultResponseTimeout||15000;\r\n\t}\r\n\t//sender side\r\n\t/**\r\n\t * @description generate id (exclude 0)\r\n\t * @returns {number}  \r\n\t */\r\n\t_generateId(){\r\n\t\tif(this.reqList.size===0xFFFFFFFF)return false;//no id can be used\r\n\t\twhile(this.reqList.has(this._currentID)){//find available id\r\n\t\t\tthis._currentID++;\r\n\t\t\tif(this._currentID===0xFFFFFFFF)this._currentID=1;\r\n\t\t}\r\n\t\treturn this._currentID;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @description buffer handle\r\n\t * @param {ArrayBuffer} data\tdata from remote rpc sender\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\thandle(data,source){\r\n\t\tlet Message_msg=new Message(data);\r\n\t\tif(Message_msg.isCtrl===true){//it's a control pack\r\n\t\t\tthis._controlHandle(Message_msg.type,Message_msg.data(),source);\r\n\t\t}else if(Message_msg.isRequest===true){//it's a request\r\n\t\t\tthis._requestHandle(Message_msg,source);\r\n\t\t}else{//it's a response\r\n\t\t\tthis._responseHandle(Message_msg,source);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description send request\r\n\t * @param {*} data\r\n\t * @param {function(Error,any)} callback\r\n\t * @param {object} opt\r\n\t * @returns {Request}  \r\n\t */\r\n\trequest(data,callback,opt){\t\r\n\t\tif(typeof opt!== 'object')opt={};\r\n\t\tlet id=0,request,rand;\r\n\t\tif(typeof callback === 'function'){\r\n\t\t\tif((id=this._generateId())===false)throw(new Error('No free id'));\r\n\t\t}\r\n\t\tif(id!==0){\r\n\t\t\trand=Request.generateRandom();\r\n\t\t}\r\n\t\tlet buffer=Message.pack(true,data,id,rand);\r\n\t\tif(id!==0){\r\n\t\t\trequest=new Request(this,id,callback,rand);\r\n\t\t\tthis.reqList.set(id,request);\r\n\t\t\trequest.setTimeout(opt.timeout||this.defaultRequestTimeout);\r\n\t\t}\r\n\t\tthis._send(buffer).then(err=>{\r\n\t\t\terr&&request.callback(err);\r\n\t\t});\r\n\t\treturn request;\r\n\t}\r\n\t/**\r\n\t * @description\tsend control message\r\n\t * @param {number} name\r\n\t * @param {*} data\r\n\t * @returns {Promise<Error>}\terror of send\r\n\t */\r\n\tcontrol(name,data){\r\n\t\tlet msg=new ControlMsg(name,data);\r\n\t\tlet buffer=Message._pack(true,false,msg.code,msg.buf,0);\r\n\t\treturn this._send(buffer);\r\n\t}\r\n\t/**\r\n\t * @description delete the req instance from map\r\n\t * @param {Request|InRequest} req\r\n\t */\r\n\tdelete(req){\r\n\t\tlet id=req.id;\r\n\t\tif(req instanceof Request){\r\n\t\t\tif(this.reqList.get(id) === req)\r\n\t\t\t\tthis.reqList.delete(id);\r\n\t\t\telse{throw(new Error('Deleting unknown req'))}\r\n\t\t\treq._destructor();\r\n\t\t}else if(req instanceof InRequest){\r\n\t\t\tif(this.inReqList.get(id) === req)\r\n\t\t\t\tthis.inReqList.delete(id);\r\n\t\t\telse{throw(new Error('Deleting unknown inReq'))}\r\n\t\t\treq._destructor();\r\n\t\t}else{\r\n\t\t\tconsole.error('arg: ',req);\r\n\t\t\tthrow(new Error('Wrong type'));\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description\tset sender of data.\r\n\t * @description\tsync sender : return send Error;\r\n\t * @description\tasync sender : resolve to send Error;\r\n\t * @param {function} func\r\n\t */\r\n\tsetSender(func){\r\n\t\tif(typeof func!=='function')\r\n\t\t\tthrow(new TypeError('not a function'));\r\n\t\t/* \r\n\t\t\tsync sender:return send Error\r\n\t\t*/\r\n\t\tthis._sender=func;\r\n\t}\r\n\t/**\r\n\t * @description\tsend buffer by sender function\r\n\t * @param {ArrayBuffer} buf\r\n\t * @returns {Promise<Error>}  \r\n\t */\r\n\tasync _send(buf){\r\n\t\tif(this._sender){\r\n\t\t\tif((await this._sender(buf)) instanceof Error === false)return;\r\n\t\t\treturn await this._sender(buf);//retry\r\n\t\t}\r\n\t\tthrow(new Error('sender not defined'));\r\n\t}\r\n\t//receviver side\r\n\t/**\r\n\t * @description\tmake a message to respond the request\r\n\t * @param {InRequest} InRequest_req\r\n\t * @param {*} data\r\n\t */\r\n\t_respond(InRequest_req,data){\r\n\t\tlet msg=InRequest_req.msg;\r\n\t\tif(!msg.hasID)\r\n\t\t\tthrow(new Error('The request dosen\\'t need a response'));\r\n\t\tif(this.inReqList.get(msg.id) !== InRequest_req){\r\n\t\t\tconsole.debug('Missing id');\r\n\t\t\t//ignore ids that not exist\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet Buffer_buf=Message.pack(false,data,msg.id,msg.random);\r\n\t\tthis._send(Buffer_buf);\r\n\t\tthis.delete(InRequest_req);\r\n\t}\r\n\t/**\r\n\t * @description\thandle control operation\r\n\t * @param {*} code received control code\r\n\t * @param {*} data received control data\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\t_controlHandle(code,data,source){\r\n\t\tswitch(code){\r\n\t\t\tcase ControlMsg.codes.abort:{//cancel an operation\r\n\t\t\t\tlet InRequest_req=this.inReqList.get(data);//data: id\r\n\t\t\t\tif(!InRequest_req)\r\n\t\t\t\t\treturn;//ignore\r\n\t\t\t\tInRequest_req._abort('remote abort');\r\n\t\t\t\tthis.delete(InRequest_req);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tdefault:{\r\n\t\t\t\tconsole.debug('Unknown control code:'+code);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description\thandle received request\r\n\t * @param {Message} Message_msg\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\t_requestHandle(Message_msg,source){\r\n\t\tif(this.inReqList.has(Message_msg.id)){\r\n\t\t\tthis._respond(Message_msg,RPC.Error(4104));//Duplicate id\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet InRequest_req=new InRequest(Message_msg,this,source);//create a response for the request\r\n\t\tif(Message_msg.id){\r\n\t\t\tInRequest_req.setTimeout(this.defaultResponseTimeout);\r\n\t\t\tthis.inReqList.set(Message_msg.id,InRequest_req);\r\n\t\t}\r\n\t\tthis.emit('request',InRequest_req,(r)=>{//emit a request event for the request handle created by you\r\n\t\t\t//remove saved inReq\r\n\t\t\tif(InRequest_req.msg.id&&(this.inReqList.get(Message_msg.id)===InRequest_req))\r\n\t\t\t\tthis._respond(InRequest_req,r);\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * @description\thandle received response\r\n\t * @param {Message} Message_msg\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\t_responseHandle(Message_msg,source){\r\n\t\tlet Request_req=this.reqList.get(Message_msg.id);\r\n\t\tif(!Request_req){\r\n\t\t\tconsole.debug('no req for id:'+Message_msg.id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Request_req.random!==Message_msg.random)\r\n\t\t\treturn;//ignore wrong response\r\n\t\tif(Message_msg.isError){\r\n\t\t\tRequest_req.callback(Message_msg.data());\r\n\t\t}else{\r\n\t\t\tRequest_req.callback(null,Message_msg.data());\r\n\t\t}\r\n\t\tthis.delete(Request_req);\r\n\t}\r\n\t/**\r\n\t *destroy this instance and directly return error for all requests\r\n\t */\r\n\tdestroy(){\r\n\t\tfor(let [id,request] of this.reqList){\r\n\t\t\trequest.callback(new Error('connection destroyed'));\r\n\t\t}\r\n\t\tfor(let [id,InRequest_req] of this.inReqList){\r\n\t\t\tInRequest_req._abort('connection destroyed');\r\n\t\t}\r\n\t\tthis.reqList.clear();\r\n\t\tthis.inReqList.clear();\r\n\t}\r\n}\r\n\r\nmodule.exports = {\r\n\tRPC,\r\n};\r\n"],"names":["fn","context","once","addListener","emitter","event","TypeError","evt","prefix","_events","listener","push","_eventsCount","Events","has","Object","prototype","hasOwnProperty","create","__proto__","EventEmitter","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","len","arguments","removeListener","args","apply","j","on","clearEvent","removeAllListeners","off","prefixed","module","exports","require$$0","Number","MAX_SAFE_INTEGER","isSafeInteger","a","isInteger","Math","abs","b","isFinite","floor","global","ArrayBuffer","TypedArray","SUPPORT_ARRAYBUFFER","Float32Array","constructor","isView","DataView","decoder","tmpFloat64Array1","tmpUint8Array1","Uint8Array","tmpUint8Array9","str","encode","uint8","decode","buffers","offsets","totalLength","ai","byteLength","result","set","Message","id","random","head","type","_data","hasID","payload","isRequest","data","buffer","view","getUint32","isCtrl","isError","ControlMsg","parseData","uint8ToStr","JSON","parse","getFloat64","bStr","BigInt","ErrorMsg","strToUint8","stringify","code","msg","buf","Error","setFloat64","toString","req","err","randomNum","fill","setUint32","bufs","concatArrayBuffers","toFrameData","_pack","msgErrorCodes","message","cache","abort","codes","isValidId","responded","timeout","rpc","callback","cb","control","delete","setTimeout","time","clearTimeout","_timeout","_destructor","round","aborted","source","Message_msg","_reachTimeout","_abort","str_msg","_respond","RPC","_currentID","defaultRequestTimeout","defaultResponseTimeout","reqList","inReqList","_checkerTimer","_sender","opt","_generateId","size","handle","_controlHandle","_requestHandle","_responseHandle","request","rand","Request","generateRandom","pack","_send","then","get","InRequest","error","setSender","func","InRequest_req","console","debug","Buffer_buf","r","Request_req","destroy","clear","jsObjRpc"],"mappings":"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"}