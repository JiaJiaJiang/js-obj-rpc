{"version":3,"file":"rpc.js","sources":["../node_modules/eventemitter3/index.js","../index.js"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","/*\r\nCopyright luojia@luojia.me\r\nMIT LICENSE\r\n*/\r\n\r\n/* \r\nmessage structure\r\nByte 0\r\n\t[0] \t\t0:request\r\n\t\t\t\t1:response\r\n\t[1] request:\t0: no id\r\n\t\t\t\t\t1:has id\r\n\t\tresponse:\t0:normal response\r\n\t\t\t\t\t1:error message\r\n\t[2] reserved\r\n\t[3-7] message type\r\n\t\t0-7: \tsee: ControlMsg\r\n\t\t8:\t\tdata true\r\n\t\t9:\t\tdata false\r\n\t\t10:\t\tdata binary\r\n\t\t11:\t\tdata string\r\n\t\t12:\t\tdata json string\r\n\t\t13:\t\tdata double js number\r\n\t\t14:\t\tdata undefined\r\n\t\t15:\t\tdata null\r\n\t\t16:\t\tdata bigint\r\n\t\t16-31:\treserved\r\n[\r\n\tByte 1-4\r\n\t\tmessage id (if has id or is a response)\r\n\tByte 5-8\r\n\t\trandom number\r\n]\r\nByte -\r\n\tdata\r\n*/\r\nvar events=require('eventemitter3');\r\n\r\n//Polyfill\r\nNumber.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=0x1fffffffffffff);\r\nif(!Number.isSafeInteger)\r\nNumber.isSafeInteger=function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER};\r\nif(!Number.isInteger)\r\nNumber.isInteger=function(b){return\"number\"==typeof b&&isFinite(b)&&Math.floor(b)===b};\r\n\r\n\r\nconst SUPPORT_ARRAYBUFFER=!!global.ArrayBuffer;\r\nconst TypedArray=SUPPORT_ARRAYBUFFER&&global.Float32Array.prototype.constructor.__proto__;\r\nif(SUPPORT_ARRAYBUFFER && !ArrayBuffer.isView){//ArrayBuffer.isView\r\n\tArrayBuffer.isView=a=>!!((TypedArray&&(a instanceof TypedArray))||(global.DataView&&(a instanceof DataView)));\r\n}\r\n\r\nconst encoder = new TextEncoder();\r\nconst decoder=new TextDecoder()\r\nconst tmpFloat64Array1=new Float64Array(1),\r\n\ttmpUint8Array1=new Uint8Array(1),\r\n\ttmpUint8Array9=new Uint8Array(9);\r\nfunction strToUint8(str){\r\n\treturn encoder.encode(str);\r\n}\r\nfunction uint8ToStr(uint8){\r\n\treturn decoder.decode(uint8);\r\n}\r\nfunction getSliceInArrayBuffer(typedArray){\r\n\treturn typedArray.buffer.slice(typedArray.byteOffset,typedArray.byteOffset+typedArray.byteLength);\r\n}\r\nfunction concatArrayBuffers(buffers){\r\n\tlet offsets=new Array(buffers.length),totalLength=0;\r\n\tfor(let ai=0;ai<buffers.length;ai++){\r\n\t\toffsets[ai]=totalLength;\r\n\t\ttotalLength+=buffers[ai].byteLength;\r\n\t\tif(buffers[ai] instanceof ArrayBuffer){\r\n\t\t\tbuffers[ai]=new Uint8Array(buffers[ai]);\r\n\t\t}\r\n\t}\r\n\tconst result=new Uint8Array(totalLength);\r\n\tfor(let i=0;i<buffers.length;i++){\r\n\t\tresult.set(buffers[i],offsets[i]);\r\n\t}\r\n\treturn result;\r\n}\r\n/**\r\n * @description\tMessage object\r\n * @class Message\r\n */\r\nclass Message{\r\n\tid;\r\n\trandom;\r\n\thead;\r\n\ttype;\r\n\t_data;\r\n\thasID;\r\n\tpayload;\r\n\tisRequest;\r\n\t/**\r\n\t * Creates an instance of Message.\r\n\t * @param {ArrayBuffer} data\r\n\t */\r\n\tconstructor(data){\r\n\t\tif(ArrayBuffer.isView(data) || (data instanceof ArrayBuffer)===true)data=new Uint8Array(data);\r\n\t\telse{\r\n\t\t\tthrow(new TypeError('Wrong data'));\r\n\t\t}\r\n\t\tif(data.byteLength===0){\r\n\t\t\tthrow(new Error('Bad message'));\r\n\t\t}\r\n\t\tdata=new Uint8Array(data);\r\n\t\tthis.head=data[0];\r\n\t\tthis.isRequest=(this.head&0b10000000)===0;\r\n\t\tthis.hasID=this.isRequest?(this.head&0b01000000)===0b01000000:true;\r\n\t\t// this.finished=(head&0b00100000)===0b00100000;//finished flag\r\n\t\tif(this.hasID){//calc id\r\n\t\t\tif(data.byteLength<5){\r\n\t\t\t\tthrow(new Error('Bad message'));\r\n\t\t\t}\r\n\t\t\tconst view=new DataView(data.buffer,data.byteOffset,data.byteLength);\r\n\t\t\tthis.id=view.getUint32(1);\r\n\t\t\tthis.random=view.getUint32(5);\r\n\t\t}\r\n\t\tthis.type=this.head&0b00011111;//type of the message\r\n\t\tthis.payload=data.buffer.slice(data.byteOffset+this.hasID?9:1,data.byteLength);\r\n\t\tthis._data;//data cache\r\n\t}\r\n\t/**\r\n\t * @description\tis control message\r\n\t * @readonly\r\n\t */\r\n\tget isCtrl(){\r\n\t\treturn this.type<8;\r\n\t}\r\n\t/**\r\n\t * @description\tis error message\r\n\t * @readonly\r\n\t */\r\n\tget isError(){\r\n\t\tif((this.head&0x40)===0x40){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t/**\r\n\t * @description parse data\r\n\t * @returns {any}\tcarried data\r\n\t */\r\n\tdata(){\r\n\t\tif(this._data!==undefined)return this._data;\r\n\t\tthis._data=(()=>{\r\n\t\t\tif(this.type<8)return ControlMsg.parseData(this.type,this.payload);\r\n\t\t\tswitch(this.type){\r\n\t\t\t\tcase 8:return true;\r\n\t\t\t\tcase 9:return false;\r\n\t\t\t\tcase 10:return this.payload;//binary\r\n\t\t\t\tcase 11:return uint8ToStr(this.payload);//string\r\n\t\t\t\tcase 12:return JSON.parse(uint8ToStr(this.payload));//json\r\n\t\t\t\tcase 13://js number\r\n\t\t\t\t\tif(this.payload.byteLength!==8)\r\n\t\t\t\t\t\tthrow('Wrong data length for number');\r\n\t\t\t\t\tconst view=new DataView(this.payload);\r\n\t\t\t\t\treturn view.getFloat64(0);\r\n\t\t\t\tcase 14:return undefined;\r\n\t\t\t\tcase 15:return null;\r\n\t\t\t\tcase 16:{\r\n\t\t\t\t\tconst bStr=uint8ToStr(this.payload);\r\n\t\t\t\t\tif(bStr[0]==='-')return -BigInt('0x'+bStr.slice(1));\r\n\t\t\t\t\treturn BigInt('0x'+bStr);\r\n\t\t\t\t}\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow('Unknown data type');\r\n\t\t\t}\r\n\t\t})();\r\n\t\treturn this._data;\r\n\t}\r\n\t/**\r\n\t * @description\tconvert different data to message format buffer\r\n\t * @static\r\n\t * @param {any} data\tdata that defined at top of this file\r\n\t * @returns {[number,ArrayBuffer]}\t[type code, data buffer]\r\n\t */\r\n\tstatic toFrameData(data){\r\n\t\tif(data===undefined)return [14];\r\n\t\tif(data===null)return [15];\r\n\t\tif(data===true)return [8];\r\n\t\tif(data===false)return [9];\r\n\t\tif(data instanceof ErrorMsg){\r\n\t\t\treturn [12,strToUint8(JSON.stringify({code:data.code||4100,msg:data.msg}))];\r\n\t\t}\r\n\t\tif(data instanceof ControlMsg){\r\n\t\t\treturn [data.code,data.buf];\r\n\t\t}\r\n\t\tif(data instanceof ArrayBuffer||ArrayBuffer.isView(data)){\r\n\t\t\treturn [10,data.buffer?getSliceInArrayBuffer(data):data];\r\n\t\t}\r\n\t\tif(data instanceof Error){\r\n\t\t\tthrow('Dont use Error, use RPC.Error instead');\r\n\t\t}\r\n\t\tswitch(typeof data){\r\n\t\t\tcase 'string':return [11,strToUint8(data)];\r\n\t\t\tcase 'object':return [12,strToUint8(JSON.stringify(data))];\r\n\t\t\tcase 'number':\r\n\t\t\t\tconst view=new DataView(tmpFloat64Array1.buffer,tmpFloat64Array1.byteOffset,tmpFloat64Array1.byteLength);\r\n\t\t\t\tview.setFloat64(0,data);\r\n\t\t\t\treturn [13,getSliceInArrayBuffer(view)];\r\n\t\t\tcase 'bigint':\r\n\t\t\t\treturn [16,strToUint8(data.toString(16))];\r\n\t\t}\r\n\t\t// console.error('data: ',data);//debug\r\n\t\tthrow(new TypeError('Unsupported data type: '+typeof data));\r\n\t}\r\n\t/**\r\n\t * @description\tpack data into message buffer\r\n\t * @static\r\n\t * @param {boolean} req\tis request\r\n\t * @param {boolean} err\tis error\r\n\t * @param {number} type\ttype code\r\n\t * @param {ArrayBuffer} buf\tdata buffer\r\n\t * @param {number} id\tmessage id\r\n\t * @param {number} randomNum\ta random number for preventing id confict\r\n\t * @returns {ArrayBuffer}  \r\n\t */\r\n\tstatic _pack(req,err,type,buf,id,randomNum){\r\n\t\tlet hasID=typeof id==='number' && id>0;\r\n\t\tlet head=(hasID?tmpUint8Array9:tmpUint8Array1);//alloc the head buffer\r\n\t\thead.fill(0);\r\n\t\tif(req===true){//request\r\n\t\t\tif(hasID)head[0]|=0b01000000;//set id flag\r\n\t\t}else{//response\r\n\t\t\thead[0]=0b10000000;//set as response\r\n\t\t\tif(err){head[0]|=0b01000000;}//set err msg flag\r\n\t\t}\r\n\t\thead[0]|=type;\r\n\t\tlet bufs=[head];\r\n\t\tif(hasID){\r\n\t\t\tif(id>=0xFFFFFFFF)\r\n\t\t\t\tthrow(new Error('id out of range'));\r\n\t\t\tconst view=new DataView(head.buffer,head.byteOffset,head.byteLength);\r\n\t\t\tview.setUint32(1,id);//write id\r\n\t\t\tview.setUint32(5,randomNum);//write randomNum\r\n\t\t}\r\n\t\tif(buf&&buf.byteLength)bufs.push(buf);\r\n\t\treturn concatArrayBuffers(bufs);\r\n\t}\r\n\t/**\r\n\t * @description\tpack data into message buffer\r\n\t * @static\r\n\t * @param {boolean} req\tis request\r\n\t * @param {any} data\tdata to send\r\n\t * @param {number} id\tmessage id\r\n\t * @param {number} randomNum\ta random number for preventing id confict\r\n\t * @returns {ArrayBuffer}\tpacked message\r\n\t */\r\n\tstatic pack(req,data,id,randomNum){//data:buffer, sig:sign the data, finished:the response has finished\r\n\t\tlet [type,buf]=Message.toFrameData(data);//get data type and meg buffer\r\n\t\tlet err=data instanceof ErrorMsg;\r\n\t\treturn Message._pack(req,err,type,buf,id,randomNum);\r\n\t}\r\n\tstatic  msgErrorCodes={\r\n\t\t4100:'',//free message\r\n\t\t4101:'Forbidden',\r\n\t\t4102:'Cannot parse the data',\r\n\t\t4103:'Not supported operation',\r\n\t\t4104:'Duplicate id',\r\n\t\t4105:'Time out',\r\n\t}\r\n\t/**\r\n\t * @description\tis valid id\r\n\t * @static\r\n\t * @param {number} id\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isValidId(id){\r\n\t\treturn typeof id==='number'&&id>0&&id<=0xFFFFFFFF;\r\n\t}\r\n}\r\n\r\n/**\r\n * @description error message\r\n * @class ErrorMsg\r\n */\r\nclass ErrorMsg{\r\n\t/**\r\n\t * Creates an instance of ErrorMsg.\r\n\t * @param {any} code\terror code to return\r\n\t * @param {string} [msg='']\terror message to return\r\n\t */\r\n\tconstructor(code,msg=''){\r\n\t\tthis.code=code;\r\n\t\tif(typeof msg==='string'){\r\n\t\t\tthis.msg=msg;\r\n\t\t}else if(msg instanceof Error){\r\n\t\t\tthis.msg=msg.message;\r\n\t\t}else{\r\n\t\t\tthrow(new Error('Not supported message type'));\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @description control message\r\n * @class ControlMsg\r\n */\r\nclass ControlMsg{\r\n\tstatic cache={};\r\n\tstatic codes={\r\n\t\tabort:1,//abort an operation\r\n\t}\r\n\tcode;\r\n\tbuf;\r\n\t/**\r\n\t * Creates an instance of ControlMsg.\r\n\t * @param {string} name name of the control operation\r\n\t * @param {*} data\tdata of the control message\r\n\t */\r\n\tconstructor(name,data){\r\n\t\tif(name in ControlMsg.codes === false){\r\n\t\t\tthrow(new Error('Unknown operation name'));\r\n\t\t}\r\n\t\tthis.code=ControlMsg.codes[name];\r\n\t\tswitch(this.code){\r\n\t\t\tcase ControlMsg.codes.abort://abort message\r\n\t\t\t\tif(!Message.isValidId(data))\r\n\t\t\t\t\tthrow('Invalid id: '+data);\r\n\t\t\t\tthis.buf=new ArrayBuffer(4);\r\n\t\t\t\t(new DataView(this.buf)).setUint32(0,data);\r\n\t\t\t\t// this.buf.writeUInt32BE(data);//set msg id to be aborted\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description\tconvert control message payload to number\r\n\t * @static\r\n\t * @param {number} code\tcontrol code\r\n\t * @param {ArrayBuffer} buf\tcontrol message payload\r\n\t * @returns {number}  \r\n\t */\r\n\tstatic parseData(code,buf){\r\n\t\tswitch(code){\r\n\t\t\tcase ControlMsg.codes.abort:\r\n\t\t\t\treturn (new DataView(buf)).getUint32(0);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @description request from remote\r\n * @class Request\r\n */\r\nclass Request{\r\n\tresponded=false;\r\n\ttimeout;\r\n\t/**\r\n\t * Creates an instance of Request.\r\n\t * @param {RPC} rpc\r\n\t * @param {number} id\tmessage id\r\n\t * @param {function(...any)} callback\treceive response data\r\n\t * @param {number} random\ta random number for preventing id confict\r\n\t */\r\n\tconstructor(rpc,id,callback,random){\r\n\t\tthis.id=id;\r\n\t\tthis.rpc=rpc;\r\n\t\tthis.cb=callback;\r\n\t\tthis.random=random;\r\n\t}\r\n\t/**\r\n\t * @description\tabort the request, depends on remote data handle\r\n\t */\r\n\tabort(){\r\n\t\tthis.rpc.control('abort',this.id);\r\n\t\tthis.rpc.delete(this);\r\n\t}\r\n\t/**\r\n\t * @description\tfill response data when the remote rpc respond\r\n\t * @param {*} args\r\n\t */\r\n\tcallback(...args){\r\n\t\tif(this.responded)\r\n\t\t\tthrow(new Error('RPC responded'));\r\n\t\tthis.responded=true;\r\n\t\tif(this.cb)\r\n\t\t\tthis.cb(...args);\r\n\t}\r\n\t/**\r\n\t * @description set time out of the request\r\n\t * @param {*} time\r\n\t */\r\n\tsetTimeout(time){//\r\n\t\tif(typeof time!=='number'||!(time>=0))\r\n\t\t\tthrow(new Error('Wrong timeout'));\r\n\t\tif(this.timeout)\r\n\t\t\tclearTimeout(this.timeout);\r\n\t\tthis.timeout=setTimeout(()=>this._timeout(),time);\r\n\t}\r\n\t/**\r\n\t * @description when timeout reaches, an abort control will be sent\r\n\t */\r\n\t_timeout(){\r\n\t\tthis.timeout=0;\r\n\t\tthis.callback(new Error('Time out'));\r\n\t\tthis.abort();\r\n\t}\r\n\t_destructor(){\r\n\t\tthis.cb=null;\r\n\t\tthis.rpc=null;\r\n\t\tif(this.timeout){\r\n\t\t\tclearTimeout(this.timeout);\r\n\t\t\tthis.timeout=0;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description\tgenerate a random number\r\n\t * @static\r\n\t * @returns {number}  \r\n\t */\r\n\tstatic generateRandom(){\r\n\t\treturn Math.round(4294967295*Math.random());\r\n\t}\r\n}\r\n\r\n/* \r\nevents\r\n\tabort\r\n*/\r\n/**\r\n * @description incoming request\r\n * @class InRequest\r\n * @extends {events}\r\n */\r\nclass InRequest extends events{\r\n\t_timeout;\r\n\taborted=false;\r\n\tresponded=false;\r\n\tsource;\r\n\t/**\r\n\t * Creates an instance of InRequest.\r\n\t * @param {Message} Message_msg\r\n\t * @param {RPC} rpc\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\tconstructor(Message_msg,rpc,source){\r\n\t\tsuper();\r\n\t\tthis.rpc=rpc;\r\n\t\tthis.msg=Message_msg;\r\n\t\tthis.source=source;\r\n\t}\r\n\t/**\r\n\t * @description\tget message id\r\n\t * @readonly\r\n\t */\r\n\tget id(){return this.msg.id;}\r\n\t/**\r\n\t * @description\tget data of the message, wil be recovered to thier origin type\r\n\t * @returns {any}  \r\n\t */\r\n\tdata(){\r\n\t\treturn this.msg.data();\r\n\t}\r\n\t/**\r\n\t * @description\tset timeout of the incoming request\r\n\t * @param {*} time\r\n\t */\r\n\tsetTimeout(time){\r\n\t\tif(typeof time!=='number'||!(time>=0))\r\n\t\t\tthrow(new Error('Wrong timeout'));\r\n\t\tif(this._timeout)\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\tthis._timeout=setTimeout(()=>this._reachTimeout(),time);\r\n\t}\r\n\t_abort(str_msg){\r\n\t\tthis.aborted=true;\r\n\t\tthis.emit('abort',str_msg);\r\n\t}\r\n\t/**\r\n\t * @description when timeout reaches, rpc will send an error back to remote\r\n\t */\r\n\t_reachTimeout(){\r\n\t\tthis._timeout=0;\r\n\t\tthis._abort('time out');\r\n\t\tthis.rpc._respond(this,RPC.Error(4105));\r\n\t}\r\n\t_destructor(){\r\n\t\tthis.rpc=null;\r\n\t\tthis.msg=null;\r\n\t\tif(this._timeout){\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tthis._timeout=0;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/* \r\nAlways call the callback of the 'request' event, otherwise the requests will reach timeout\r\n*/\r\n/**\r\n * @description RPC handle\r\n * @class RPC\r\n * @extends {events}\r\n */\r\nclass RPC extends events{\r\n\tstatic Error(code,msg){\r\n\t\treturn new ErrorMsg(code,msg||Message.msgErrorCodes[code]||'Unexpected error');\r\n\t}\r\n\tdebug=false;\r\n\t_currentID=1;\r\n\tdefaultRequestTimeout;\r\n\tdefaultResponseTimeout;\r\n\treqList=new Map();//id => Request\r\n\tinReqList=new Map();//id => InRequest\r\n\t_checkerTimer;\r\n\t_sender;\r\n\tconstructor(opt={}){\r\n\t\tsuper();\r\n\t\tthis.defaultRequestTimeout=opt.defaultRequestTimeout||15000;\r\n\t\tthis.defaultResponseTimeout=opt.defaultResponseTimeout||15000;\r\n\t}\r\n\t//sender side\r\n\t/**\r\n\t * @description generate id (exclude 0)\r\n\t * @returns {number}  \r\n\t */\r\n\t_generateId(){\r\n\t\tif(this.reqList.size===0xFFFFFFFF)return false;//no id can be used\r\n\t\twhile(this.reqList.has(this._currentID)){//find available id\r\n\t\t\tthis._currentID++;\r\n\t\t\tif(this._currentID===0xFFFFFFFF)this._currentID=1;\r\n\t\t}\r\n\t\treturn this._currentID;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @description buffer handle\r\n\t * @param {ArrayBuffer} data\tdata from remote rpc sender\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\thandle(data,source){\r\n\t\tlet Message_msg=new Message(data);\r\n\t\tif(Message_msg.isCtrl===true){//it's a control pack\r\n\t\t\tthis._controlHandle(Message_msg.type,Message_msg.data(),source);\r\n\t\t}else if(Message_msg.isRequest===true){//it's a request\r\n\t\t\tthis._requestHandle(Message_msg,source);\r\n\t\t}else{//it's a response\r\n\t\t\tthis._responseHandle(Message_msg,source);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description send request\r\n\t * @param {*} data\r\n\t * @param {function(Error,any)} callback\r\n\t * @param {object} opt\r\n\t * @returns {Request}  \r\n\t */\r\n\trequest(data,callback,opt){\t\r\n\t\tif(typeof opt!== 'object')opt={};\r\n\t\tlet id=0,request,rand;\r\n\t\tif(typeof callback === 'function'){\r\n\t\t\tif((id=this._generateId())===false)throw(new Error('No free id'));\r\n\t\t}\r\n\t\tif(id!==0){\r\n\t\t\trand=Request.generateRandom();\r\n\t\t}\r\n\t\tlet buffer=Message.pack(true,data,id,rand);\r\n\t\tif(id!==0){\r\n\t\t\trequest=new Request(this,id,(err,res)=>{\r\n\t\t\t\tif(err&&this.debug){\r\n\t\t\t\t\tconsole.debug('RPC receive error','req:',data,'err:',err);\r\n\t\t\t\t}\r\n\t\t\t\tif(callback)callback(err,res);\r\n\t\t\t},rand);\r\n\t\t\tthis.reqList.set(id,request);\r\n\t\t\trequest.setTimeout(opt.timeout||this.defaultRequestTimeout);\r\n\t\t}\r\n\t\tthis._send(buffer).then(err=>{\r\n\t\t\tif(err&&this.debug){\r\n\t\t\t\tconsole.debug('RPC send error','req:',data,'err:',err);\r\n\t\t\t}\r\n\t\t\terr&&request.callback(err);\r\n\t\t});\r\n\t\treturn request;\r\n\t}\r\n\t/**\r\n\t * @description\tsend control message\r\n\t * @param {number} name\r\n\t * @param {*} data\r\n\t * @returns {Promise<Error>}\terror of send\r\n\t */\r\n\tcontrol(name,data){\r\n\t\tlet msg=new ControlMsg(name,data);\r\n\t\tlet buffer=Message._pack(true,false,msg.code,msg.buf,0);\r\n\t\treturn this._send(buffer);\r\n\t}\r\n\t/**\r\n\t * @description delete the req instance from map\r\n\t * @param {Request|InRequest} req\r\n\t */\r\n\tdelete(req){\r\n\t\tlet id=req.id;\r\n\t\tif(req instanceof Request){\r\n\t\t\tif(this.reqList.get(id) === req)\r\n\t\t\t\tthis.reqList.delete(id);\r\n\t\t\telse{throw(new Error('Deleting unknown req'))}\r\n\t\t\treq._destructor();\r\n\t\t}else if(req instanceof InRequest){\r\n\t\t\tif(this.inReqList.get(id) === req)\r\n\t\t\t\tthis.inReqList.delete(id);\r\n\t\t\telse{throw(new Error('Deleting unknown inReq'))}\r\n\t\t\treq._destructor();\r\n\t\t}else{\r\n\t\t\tconsole.error('arg: ',req);\r\n\t\t\tthrow(new Error('Wrong type'));\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description\tset sender of data.\r\n\t * @description\tsync sender : return send Error;\r\n\t * @description\tasync sender : resolve to send Error;\r\n\t * @param {function} func\r\n\t */\r\n\tsetSender(func){\r\n\t\tif(typeof func!=='function')\r\n\t\t\tthrow(new TypeError('not a function'));\r\n\t\t/* \r\n\t\t\tsync sender:return send Error\r\n\t\t*/\r\n\t\tthis._sender=func;\r\n\t}\r\n\t/**\r\n\t * @description\tsend buffer by sender function\r\n\t * @param {ArrayBuffer} buf\r\n\t * @returns {Promise<Error>}  \r\n\t */\r\n\tasync _send(buf){\r\n\t\tif(this._sender){\r\n\t\t\tif((await this._sender(buf)) instanceof Error === false)return;\r\n\t\t\treturn await this._sender(buf);//retry\r\n\t\t}\r\n\t\tthrow(new Error('sender not defined'));\r\n\t}\r\n\t//receviver side\r\n\t/**\r\n\t * @description\tmake a message to respond the request\r\n\t * @param {InRequest} InRequest_req\r\n\t * @param {*} data\r\n\t */\r\n\t_respond(InRequest_req,data){\r\n\t\tlet msg=InRequest_req.msg;\r\n\t\tif(!msg.hasID)\r\n\t\t\tthrow(new Error('The request dosen\\'t need a response'));\r\n\t\tif(this.inReqList.get(msg.id) !== InRequest_req){\r\n\t\t\tif(this.debug)console.debug('Missing id');\r\n\t\t\t//ignore ids that not exist\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet Buffer_buf=Message.pack(false,data,msg.id,msg.random);\r\n\t\tthis._send(Buffer_buf);\r\n\t\tthis.delete(InRequest_req);\r\n\t}\r\n\t/**\r\n\t * @description\thandle control operation\r\n\t * @param {*} code received control code\r\n\t * @param {*} data received control data\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\t_controlHandle(code,data,source){\r\n\t\tswitch(code){\r\n\t\t\tcase ControlMsg.codes.abort:{//cancel an operation\r\n\t\t\t\tlet InRequest_req=this.inReqList.get(data);//data: id\r\n\t\t\t\tif(!InRequest_req)\r\n\t\t\t\t\treturn;//ignore\r\n\t\t\t\tInRequest_req._abort('remote abort');\r\n\t\t\t\tthis.delete(InRequest_req);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tdefault:{\r\n\t\t\t\tif(this.debug)console.debug('Unknown control code:'+code);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @description\thandle received request\r\n\t * @param {Message} Message_msg\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\t_requestHandle(Message_msg,source){\r\n\t\tif(this.inReqList.has(Message_msg.id)){\r\n\t\t\tthis._respond(Message_msg,RPC.Error(4104));//Duplicate id\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet InRequest_req=new InRequest(Message_msg,this,source);//create a response for the request\r\n\t\tif(Message_msg.id){\r\n\t\t\tInRequest_req.setTimeout(this.defaultResponseTimeout);\r\n\t\t\tthis.inReqList.set(Message_msg.id,InRequest_req);\r\n\t\t}\r\n\t\tthis.emit('request',InRequest_req,(r)=>{//emit a request event for the request handle created by you\r\n\t\t\t//remove saved inReq\r\n\t\t\tif(InRequest_req.msg.id&&(this.inReqList.get(Message_msg.id)===InRequest_req))\r\n\t\t\t\tthis._respond(InRequest_req,r);\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * @description\thandle received response\r\n\t * @param {Message} Message_msg\r\n\t * @param {*} source define a source, which will be attached to request object\r\n\t */\r\n\t_responseHandle(Message_msg,source){\r\n\t\tlet Request_req=this.reqList.get(Message_msg.id);\r\n\t\tif(!Request_req){\r\n\t\t\tif(this.debug)console.debug('no req for id:'+Message_msg.id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Request_req.random!==Message_msg.random)\r\n\t\t\treturn;//ignore wrong response\r\n\t\tif(Message_msg.isError){\r\n\t\t\tRequest_req.callback(Message_msg.data());\r\n\t\t}else{\r\n\t\t\tRequest_req.callback(null,Message_msg.data());\r\n\t\t}\r\n\t\tthis.delete(Request_req);\r\n\t}\r\n\t/**\r\n\t *destroy this instance and directly return error for all requests\r\n\t */\r\n\tdestroy(){\r\n\t\tfor(let [id,request] of this.reqList){\r\n\t\t\trequest.callback(new Error('connection destroyed'));\r\n\t\t}\r\n\t\tfor(let [id,InRequest_req] of this.inReqList){\r\n\t\t\tInRequest_req._abort('connection destroyed');\r\n\t\t}\r\n\t\tthis.reqList.clear();\r\n\t\tthis.inReqList.clear();\r\n\t}\r\n}\r\n\r\nmodule.exports = {\r\n\tRPC,\r\n};\r\n"],"names":["fn","context","once","addListener","emitter","event","TypeError","evt","prefix","_events","listener","push","_eventsCount","Events","has","Object","prototype","hasOwnProperty","create","__proto__","EventEmitter","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","len","arguments","removeListener","args","apply","j","on","clearEvent","removeAllListeners","off","prefixed","module","exports","require$$0","Number","MAX_SAFE_INTEGER","isSafeInteger","a","isInteger","Math","abs","b","isFinite","floor","global","ArrayBuffer","TypedArray","SUPPORT_ARRAYBUFFER","Float32Array","constructor","isView","DataView","encoder","TextEncoder","decoder","TextDecoder","tmpFloat64Array1","tmpUint8Array1","tmpUint8Array9","Uint8Array","str","encode","uint8","decode","typedArray","buffer","byteOffset","byteLength","buffers","totalLength","ai","offsets","result","set","id","random","head","type","_data","hasID","payload","isRequest","data","Error","view","getUint32","isCtrl","ControlMsg","parseData","parse","uint8ToStr","getFloat64","bStr","BigInt","strToUint8","JSON","stringify","code","msg","buf","getSliceInArrayBuffer","setFloat64","toString","req","err","randomNum","fill","setUint32","bufs","concatArrayBuffers","Message","toFrameData","_pack","message","cache","codes","abort","isValidId","Request","responded","timeout","rpc","callback","cb","control","delete","setTimeout","time","clearTimeout","_timeout","_destructor","round","aborted","source","Message_msg","_reachTimeout","_abort","str_msg","_respond","RPC","ErrorMsg","msgErrorCodes","debug","_currentID","defaultRequestTimeout","defaultResponseTimeout","reqList","inReqList","_checkerTimer","_sender","opt","_generateId","size","handle","_controlHandle","_requestHandle","_responseHandle","request","rand","generateRandom","pack","res","console","_send","then","get","error","setSender","func","InRequest_req","Buffer_buf","r","Request_req","isError","destroy","clear","jsObjRpc"],"mappings":"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"}